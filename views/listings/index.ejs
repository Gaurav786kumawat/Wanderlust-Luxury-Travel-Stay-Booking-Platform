<% layout("/layouts/boilerplate") %>
<style>
  /* ðŸ”¹ Filters Section */
  #filters {
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    padding: 1rem 0;
    background: linear-gradient(to right, #f3f4f6, #e2e8f0);
    border-radius: 1rem;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
  }

  #filters .text-center {
    animation: fadeInUp 0.8s ease forwards;
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  #filters .text-center:hover {
    transform: scale(1.12) rotateZ(2deg);
    cursor: pointer;
  }

  #filters .text-center .bg-white {
    transition: all 0.4s ease;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
  }

  #filters .text-center:hover .bg-white {
    background: linear-gradient(145deg, #fff, #f0f0f0);
    box-shadow: 0 12px 25px rgba(0, 102, 255, 0.2);
  }

  #filters .text-center p {
    font-weight: 500;
    color: #374151;
    font-size: 0.85rem;
    margin-top: 0.5rem;
  }

#filters .text-center:nth-child(1)  { animation-delay: 0.1s; }
#filters .text-center:nth-child(2)  { animation-delay: 0.2s; }
#filters .text-center:nth-child(3)  { animation-delay: 0.3s; }
#filters .text-center:nth-child(4)  { animation-delay: 0.4s; }
#filters .text-center:nth-child(5)  { animation-delay: 0.5s; }
#filters .text-center:nth-child(6)  { animation-delay: 0.6s; }
#filters .text-center:nth-child(7)  { animation-delay: 0.7s; }
#filters .text-center:nth-child(8)  { animation-delay: 0.8s; }
#filters .text-center:nth-child(9)  { animation-delay: 0.9s; }
#filters .text-center:nth-child(10) { animation-delay: 1.0s; }
#filters .text-center:nth-child(11) { animation-delay: 1.1s; }


  @keyframes fadeInUp {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* ðŸ”¹ Listing Links */
  .listing-link {
    animation: fadeInUp 0.6s ease forwards;
    opacity: 0;
    display: block;
  }

  .listing-link:nth-child(n) {
    animation-delay: calc(0.05s * var(--i));
  }

  /* ðŸ”¹ Cards */
  .card {
    transition: all 0.4s ease;
    border: none;
    border-radius: 1.2rem;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    cursor: pointer;
    background: #fff;
    display: flex;
    flex-direction: column;
    height: 100%;
    margin: auto;
    padding: 0.4rem; /* ðŸ”¥ New padding inside each card */
  }

  .card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 18px 35px rgba(0, 0, 0, 0.15);
  }

  .card-img-top {
    height: 10rem;
    width: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
    border-top-left-radius: 1.2rem;
    border-top-right-radius: 1.2rem;
  }

  .card:hover .card-img-top {
    transform: scale(1.05);
  }

  .card-body {
    padding: 0.95rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.25rem;
    background: #fff;
  }

  .card-text {
    padding: 1rem;
    font-size: 0.9rem;
    color: #333;
  }

  .card-text strong {
    font-size: 0.96rem;
    color: #111827;
    letter-spacing: 0.3px;
    line-height: 1.3;
  }

  .base-price {
    font-weight: bold;
    color: #0d6efd;
    font-size: 0.9rem;
  }

  .tax-info {
    font-size: 0.72rem;
    color: #777;
    display: none;
  }

  /* ðŸ”¹ Responsive Grid */
  @media (max-width: 991.98px) {
    .row-cols-sm-1 > * {
      flex: 0 0 50%;
      max-width: 50%;
    }
    .card-img-top {
      height: 9.4rem;
    }
    .card-body {
      padding: 0.9rem;
    }
  }

  @media (max-width: 767.98px) {
    .card-img-top {
      height: 8.8rem;
    }
    .card-body {
      padding: 0.8rem;
    }
  }

  @media (max-width: 575.98px) {
    .card-img-top {
      height: 8.2rem;
    }
    .card-body {
      padding: 0.7rem;
    }
    .card-text strong {
      font-size: 0.84rem;
    }
  }

  @media (max-width: 450px) {
    .card-img-top {
      height: 7.6rem;
    }
    .card-body {
      padding: 0.65rem;
    }
  }

  @media (max-width: 360px) {
    .card-img-top {
      height: 7.2rem;
    }
    .card-body {
      padding: 0.6rem;
    }
  }

  @media (max-width: 290px) {
    .row-cols-sm-1 > * {
      flex: 0 0 50%;
      max-width: 50%;
    }
    .card {
      max-width: 98vw;
    }
    .card-img-top {
      height: 6.8rem;
    }
    .card-body {
      padding: 0.55rem;
    }
  }
</style>


<!-- Filters Section -->
<div class="container-fluid py-3 bg-light border-bottom">
  <div
    class="d-flex flex-nowrap overflow-auto align-items-center gap-4 px-3"
    id="filters"
  >
    <!-- Filter Items -->
    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-fire fs-4 text-danger"></i>
      </div>
      <p class="small mt-2 mb-0">Trending</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-bed fs-4 text-primary"></i>
      </div>
      <p class="small mt-2 mb-0">Rooms</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-mountain-city fs-4 text-success"></i>
      </div>
      <p class="small mt-2 mb-0">Iconic Cities</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-mountain fs-4 text-secondary"></i>
      </div>
      <p class="small mt-2 mb-0">Mountains</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-brands fa-fort-awesome fs-4 text-warning"></i>
      </div>
      <p class="small mt-2 mb-0">Castles</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-person-swimming fs-4 text-info"></i>
      </div>
      <p class="small mt-2 mb-0">Pools</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-campground fs-4 text-success"></i>
      </div>
      <p class="small mt-2 mb-0">Camping</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-cow fs-4 text-warning"></i>
      </div>
      <p class="small mt-2 mb-0">Farms</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-igloo fs-4 text-primary"></i>
      </div>
      <p class="small mt-2 mb-0">Arctic</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-tent fs-4 text-danger"></i>
      </div>
      <p class="small mt-2 mb-0">Domes</p>
    </div>

    <div class="text-center flex-shrink-0">
      <div class="bg-white rounded-circle p-3 shadow-sm">
        <i class="fa-solid fa-sailboat fs-4 text-primary"></i>
      </div>
      <p class="small mt-2 mb-0">Boats</p>
    </div>
  </div>
</div>

<!-- Tax Inclusive Switch -->
<div class="container-fluid py-2 bg-light border-bottom mb-3">
  <div class="d-flex justify-content-end pe-4">
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" />
      <label class="form-check-label small ms-1" for="flexSwitchCheckDefault">
        Show tax-inclusive
      </label>
    </div>
  </div>
</div>

<div class="container my-5">
  <% if (searchQuery) { %>
    <h3 class="mb-4 fw-semibold" style="color: #0d6efd">
      <i class="fa-solid fa-magnifying-glass me-2"></i>
      Found <%= resultCount %> result<%= resultCount !== 1 ? "s" : "" %> for
      "<span class="text-dark"><%= searchQuery %></span>"
    </h3>
  <% } %>

  <% if (listings.length === 0) { %>
    <div class="alert alert-warning text-center fs-5 rounded-pill shadow-sm">
      No listings found matching "<%= searchQuery %>"
    </div>

    <% if (recommendations && recommendations.length > 0) { %>
      <h5 class="text-center text-secondary my-5">You might like these instead:</h5>
      <div class="row row-cols-lg-4 row-cols-md-2 row-cols-sm-1 g-4 px-3">
        <% recommendations.forEach(listing => { %>
          <a href="/listings/<%= listing._id %>" class="listing-link text-decoration-none">
            <div class="card h-100">
              <%
  const thumb = listing.images?.find(img => img.filename === listing.thumbnail);
  const imgUrl = thumb?.url || listing.images?.[0]?.url || "/images/default.jpg";
%>
<img src="<%= imgUrl %>" class="card-img-top rounded-top" alt="Listing Image" style="height: 220px; object-fit: cover;" />

              <div class="card-body">
                <p class="card-text mb-0">
                  <strong><%= listing.title %></strong><br />
                  <%= listing.location %>, <%= listing.country %>
                </p>
              </div>
            </div>
          </a>
        <% }) %>
      </div>
    <% } %>

  <% } else { %>
    <!-- =================== LISTINGS GRID =================== -->
    <div class="row row-cols-lg-4 row-cols-md-2 row-cols-sm-1 g-4 px-3">
      <% listings.forEach(listing => { %>
        <a href="/listings/<%= listing._id %>" class="listing-link text-decoration-none">
          <div class="card h-100">
            <% 
  const thumb = listing.images.find(img => img.filename === listing.thumbnail) || listing.images[0];
%>

<img
  src="<%= listing.images.find(img => img.filename === listing.thumbnail)?.url || listing.images[0]?.url || '/images/default.jpg' %>"
  class="card-img-top"
  alt="Thumbnail"
/>

            <div class="card-body">
              <p class="card-text mb-0">
                <strong><%= listing.title %></strong><br />
                â‚¹
                <span class="base-price" data-price="<%= listing.price %>">
                  <%= listing.price.toLocaleString("en-IN") %>
                </span>
                / month
                <i class="tax-info">&nbsp;&nbsp;including 18% GST</i>
              </p>
            </div>
          </div>
        </a>
      <% }) %>
    </div>
  <% } %>
</div>


  <script>
    const taxRate = 0.18;
    const toggle = document.getElementById("flexSwitchCheckDefault");

    toggle.addEventListener("change", () => {
      const basePrices = document.querySelectorAll(".base-price");
      const taxInfos = document.querySelectorAll(".tax-info");

      basePrices.forEach((basePrice, idx) => {
        const originalPrice = parseFloat(basePrice.getAttribute("data-price"));
        const taxAmount = originalPrice * taxRate;
        const totalPrice = toggle.checked
          ? originalPrice + taxAmount
          : originalPrice;

        basePrice.textContent = totalPrice.toLocaleString("en-IN");
        if (toggle.checked) {
          taxInfos[idx].style.display = "inline";
        } else {
          taxInfos[idx].style.display = "none";
        }
      });
    });
  </script>
</div>
