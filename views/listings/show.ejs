<% layout("/layouts/boilerplate") %>

<style>
  .card-custom {
  background: #ffffff;
  border-radius: 1.5rem;
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
  padding: 2rem;
  transition: box-shadow 0.3s ease;
  max-width: 100%;
  width: 100%;
  margin: 0 auto 3rem auto;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  position: relative;
}

.card-custom:hover {
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.1);
}

/* Carousel Styling */
.carousel-inner img {
  height: 400px;
  object-fit: cover;
  border-radius: 1.25rem;
  transition: transform 0.3s ease-in-out;
}

.carousel-item:hover img {
  transform: scale(1.01);
}

.carousel-indicators [data-bs-target] {
  width: 10px;
  height: 10px;
  background-color: #bbb;
  border-radius: 50%;
  opacity: 0.8;
  margin: 0 6px;
  transition: all 0.3s ease;
}

.carousel-indicators .active {
  background-color: #0d6efd;
  width: 12px;
  height: 12px;
  opacity: 1;
}

/* Carousel Controls */
.carousel-control-prev-icon,
.carousel-control-next-icon {
  background-color: rgba(33, 37, 41, 0.75);
  border-radius: 50%;
  padding: 0.75rem;
  transition: background-color 0.3s ease;
}

.carousel-control-prev-icon:hover,
.carousel-control-next-icon:hover {
  background-color: rgba(0, 0, 0, 0.9);
}

/* Listing Info */
.listing-info {
  font-family: 'Inter', sans-serif;
  color: #343a40;
  padding: 0 0.5rem;
}

.listing-info p {
  margin-bottom: 0.5rem;
  font-size: 1rem;
  line-height: 1.6;
}

.listing-info .fs-5 {
  font-size: 1.1rem !important;
}

.listing-info .fw-semibold {
  font-weight: 600;
  color: #111;
}

/* Button Group */
.button-group {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
  margin-top: 1.5rem;
}

.btn-outline,
.btn-solid,
.btn-danger {
  padding: 0.65rem 1.5rem;
  font-weight: 600;
  border-radius: 2rem;
  font-size: 1rem;
  text-decoration: none;
  transition: all 0.3s ease;
}

.btn-outline {
  color: #0d6efd;
  border: 2px solid #0d6efd;
  background-color: transparent;
}

.btn-outline:hover {
  background-color: #0d6efd;
  color: #fff;
}

.btn-solid {
  background-color: #0d6efd;
  color: white;
  border: none;
}

.btn-solid:hover {
  background-color: #084298;
}

.btn-danger {
  background-color: #dc3545;
  color: #fff;
  border: none;
}

.btn-danger:hover {
  background-color: #a71d2a;
}

/* Book Now Button */
a.btn.btn-primary.rounded-pill {
  font-size: 1.1rem;
  padding: 0.75rem 2rem;
  font-weight: 600;
  background: linear-gradient(135deg, #0d6efd, #6610f2);
  border: none;
  color: #fff;
  box-shadow: 0 6px 16px rgba(13, 110, 253, 0.3);
  transition: all 0.3s ease-in-out;
}

a.btn.btn-primary.rounded-pill:hover {
  transform: scale(1.03);
  background: linear-gradient(135deg, #084298, #4b0f9d);
}

/* Fallback image */
img.img-fluid {
  border-radius: 1.25rem;
  width: 100%;
  max-height: 400px;
  object-fit: cover;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
}

/* Responsive */
@media (max-width: 768px) {
  .card-custom {
    padding: 1rem;
  }

  .carousel-inner img,
  img.img-fluid {
    height: 250px !important;
  }

  .listing-info p {
    font-size: 0.95rem;
  }

  .btn-outline,
  .btn-solid,
  .btn-danger {
    width: 100%;
    text-align: center;
  }

  .button-group {
    flex-direction: column;
    gap: 0.75rem;
  }

  a.btn.btn-primary.rounded-pill {
    width: 100%;
  }
}

/* XS Devices ‚Äì Tiny phones */
@media (max-width: 480px) {
  .card-custom {
    padding: 0.75rem;
    border-radius: 1rem;
  }

  .carousel-inner img,
  img.img-fluid {
    height: 220px !important;
  }

  .listing-info p {
    font-size: 0.88rem;
  }

  .btn-outline,
  .btn-solid,
  .btn-danger,
  a.btn.btn-primary.rounded-pill {
    font-size: 0.95rem;
    padding: 0.55rem 1rem;
    width: 100%;
  }

  .button-group {
    flex-direction: column;
    gap: 0.5rem;
  }
}

/* SM Devices ‚Äì Mobiles */
@media (max-width: 768px) {
  .card-custom {
    padding: 1rem;
    border-radius: 1.25rem;
  }

  .carousel-inner img,
  img.img-fluid {
    height: 250px !important;
  }

  .listing-info p {
    font-size: 0.95rem;
  }

  .btn-outline,
  .btn-solid,
  .btn-danger,
  a.btn.btn-primary.rounded-pill {
    width: 100%;
    text-align: center;
  }

  .button-group {
    flex-direction: column;
    gap: 0.75rem;
  }
}

/* MD Devices ‚Äì Tablets & Small Laptops */
@media (max-width: 1024px) {
  .card-custom {
    padding: 1.25rem;
  }

  .carousel-inner img,
  img.img-fluid {
    height: 300px !important;
  }

  .listing-info p {
    font-size: 1rem;
  }

  .btn-outline,
  .btn-solid,
  .btn-danger {
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
  }

  a.btn.btn-primary.rounded-pill {
    font-size: 1rem;
    padding: 0.65rem 1.5rem;
  }
}

/* LG Devices ‚Äì Medium Desktops */
@media (max-width: 1440px) {
  .card-custom {
    max-width: 100%;
    padding: 2rem;
  }

  .carousel-inner img,
  img.img-fluid {
    height: 380px !important;
  }

  .listing-info p {
    font-size: 1.05rem;
  }
}

/* XL Devices ‚Äì Large Screens & 4K */
@media (min-width: 1441px) {
  .card-custom {
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
  }

  .carousel-inner img,
  img.img-fluid {
    height: 420px !important;
  }

  .listing-info p {
    font-size: 1.1rem;
  }

  .btn-outline,
  .btn-solid,
  .btn-danger,
  a.btn.btn-primary.rounded-pill {
    font-size: 1.05rem;
    padding: 0.75rem 2rem;
  }
}

/* Carousel Button Container */
.carousel-control-prev,
.carousel-control-next {
  width: 3rem;
  height: 3rem;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0.9;
}

/* Arrows: Smaller and Clean */
.carousel-control-prev-icon,
.carousel-control-next-icon {
  background-color: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(6px);
  border-radius: 50%;
  padding: 0.6rem;
  width: 1.75rem;
  height: 1.75rem;
  background-size: 50% 50%;  /* Makes the arrow smaller */
  background-repeat: no-repeat;
  background-position: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
  transition: all 0.3s ease;
}

/* On Hover: Slight pop */
.carousel-control-prev-icon:hover,
.carousel-control-next-icon:hover {
  transform: scale(1.08);
  background-color: rgba(255, 255, 255, 1);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

/* Hide carousel arrows on XS screens if needed */
@media (max-width: 480px) {
  .carousel-control-prev,
  .carousel-control-next {
    display: none;
  }
}

@media (max-width: 768px) {
  .carousel-inner img,
  img.img-fluid {
    height: 200px !important;
  }
}
@media (max-width: 480px) {
  .carousel-inner img,
  img.img-fluid {
    height: 180px !important;
  }
}

@media (max-width: 768px) {
  .card-custom {
    padding: 1rem 0.75rem;
    border-radius: 1rem;
  }
}
@media (max-width: 480px) {
  .card-custom {
    padding: 0.75rem 0.5rem;
  }
}

@media (max-width: 768px) {
  .listing-info p {
    margin-bottom: 0.4rem;
    font-size: 0.9rem;
    line-height: 1.4;
  }
}

@media (max-width: 768px) {
  .btn-outline,
  .btn-solid,
  .btn-danger,
  a.btn.btn-primary.rounded-pill {
    padding: 0.5rem 1.2rem;
    font-size: 0.95rem;
  }
}

@media (max-width: 480px) {
  .card-custom {
    max-height: 85vh;
    overflow-y: auto;
    scrollbar-width: none; /* Firefox */
  }

  .card-custom::-webkit-scrollbar {
    display: none; /* Chrome */
  }
}


@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* üî≤ Common Wrapper */
.review-section,
.review-form-wrapper {
  max-width: 65%;
  margin: 0 auto;
  padding: 2rem 0;
}

/* ‚≠ê Review Summary */
.review-summary {
  background: #ffffff;
  border: 1px solid #ddd;
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
  text-align: center;
  margin-bottom: 2.5rem;
}

.review-summary .star-icon {
  font-size: 2rem;
  color: #fbbf24;
  margin-bottom: 0.5rem;
}

.review-summary h5 {
  font-size: 1.4rem;
  font-weight: 700;
  margin-bottom: 0.3rem;
}

.review-summary p {
  font-size: 0.9rem;
  color: #666;
}

/* üìÑ Review Form */
.review-form {
  background: #fff;
  padding: 2rem 2.5rem;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.04);
  border: 1px solid #eee;
}

.review-form h4 {
  text-align: center;
  font-weight: 600;
  margin-bottom: 1.5rem;
}

.review-form label {
  font-weight: 600;
  margin-bottom: 0.4rem;
  display: block;
}

.review-form textarea {
  border-radius: 8px;
  padding: 1rem;
  border: 1px solid #ccc;
  resize: vertical;
}

.review-form .btn {
  font-weight: 600;
  border-radius: 999px;
}

/* üí¨ Review Cards */
.review-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  margin-top: 2rem;
}

.review-card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.04);
  padding: 1.2rem 1.4rem;
  border: 1px solid #eee;
  flex: 0 0 calc(33% - 1rem);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.review-card img {
  width: 30px;
  height: 30px;
  border-radius: 50%;
}

.review-card small {
  color: #888;
  font-size: 0.8rem;
}

.review-card .username {
  font-weight: 600;
  font-size: 0.95rem;
  margin: 0.5rem 0;
}

.review-card .review-text {
  font-size: 0.9rem;
  color: #333;
  min-height: 50px;
}

.review-card .btn {
  font-size: 0.8rem;
  margin-top: 0.8rem;
  border-radius: 999px;
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate__fadeInDown {
  animation: fadeInDown 0.4s ease-out;
}

.custom-modal {
  border-radius: 1.5rem;
  background-color: #ffffff;
  padding: 0.5rem 1rem;
  transition: all 0.3s ease;
}

.custom-modal .modal-title {
  font-size: 1.25rem;
  display: flex;
  align-items: center;
}

.cancel-btn {
  background-color: #ffffff;
  color: #6c757d;
  border: 1px solid #dee2e6;
  border-radius: 50px;
  padding: 0.5rem 1.5rem;
  font-weight: 500;
  transition: background 0.3s, transform 0.2s;
}

.cancel-btn:hover {
  background-color: #f1f3f5;
  transform: scale(1.05);
}

.delete-btn {
  background-color: #dc3545;
  color: white;
  border: none;
  border-radius: 50px;
  padding: 0.5rem 1.5rem;
  font-weight: 500;
  transition: background 0.3s, transform 0.2s;
}

.delete-btn:hover {
  background-color: #bb2d3b;
  transform: scale(1.05);
}

/* Responsive tweaks */
@media (max-width: 576px) {
  .custom-modal {
    border-radius: 1rem;
    padding: 1rem;
  }
  .modal-footer {
    flex-direction: column;
    gap: 1rem;
  }
}

/* üßä Glassmorphism Modal Background */
.custom-modal {
  border-radius: 1.5rem;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
  padding: 0.5rem 1rem;
  transition: all 0.3s ease;
}

/* Optional: if you want the modal container itself to be glassy with soft edges */
.modal-content {
  background: rgba(255, 255, 255, 0.25) !important;
  backdrop-filter: blur(16px) !important;
  -webkit-backdrop-filter: blur(16px) !important;
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 1.5rem;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

/* Buttons hover update */
.cancel-btn:hover {
  background-color: rgba(255, 255, 255, 0.25);
  color: #333;
  transform: translateY(-2px);
}

.delete-btn:hover {
  background-color: #c82333;
  transform: translateY(-2px);
}

/* Background fade effect */
.modal-backdrop.show {
  opacity: 0.3;
  background-color: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}

/* Adjust text for glassy contrast */
.modal-content .modal-body,
.modal-content .modal-title {
  color: #111 !important;
}


</style>




<div class="show-container">
  <h3 class="heading"><%= listing.title %></h3>
  <!-- Listing Card -->
  <div class="card-custom">
    <% if (listing.images && listing.images.length > 0) { %>
      <div id="listingCarousel" class="carousel slide mb-4 shadow rounded-4 overflow-hidden" data-bs-ride="carousel">

        <% const thumb = listing.images.find(img => img.filename === listing.thumbnail); %>
        <% const otherImages = listing.images.filter(img => img.filename !== listing.thumbnail); %>
        <% const finalImages = thumb ? [thumb, ...otherImages] : listing.images; %>

        <!-- üü¢ Indicators (Dots) -->
        <div class="carousel-indicators">
          <% finalImages.forEach((img, i) => { %>
            <button 
              type="button" 
              data-bs-target="#listingCarousel" 
              data-bs-slide-to="<%= i %>" 
              class="<%= i === 0 ? 'active' : '' %>" 
              aria-current="<%= i === 0 ? 'true' : 'false' %>" 
              aria-label="Slide <%= i + 1 %>">
            </button>
          <% }) %>
        </div>

        <!-- üñºÔ∏è Image Slides -->
        <div class="carousel-inner rounded-4">
          <% finalImages.forEach((img, index) => { %>
            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
              <img
                src="<%= img.url %>"
                class="d-block w-100"
                style="height: 400px; object-fit: cover;"
                alt="Listing Image <%= index + 1 %>"
              />
            </div>
          <% }) %>
        </div>

        <!-- üîÑ Prev/Next Buttons -->
        <% if (finalImages.length > 1) { %>
          <button class="carousel-control-prev" type="button" data-bs-target="#listingCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon bg-dark bg-opacity-75 rounded-circle p-2"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#listingCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon bg-dark bg-opacity-75 rounded-circle p-2"></span>
          </button>
        <% } %>
      </div>
    <% } else { %>
      <!-- Fallback Image -->
      <img
        src="/images/default.jpg"
        class="img-fluid rounded shadow-sm mb-4"
        alt="Default Image"
        style="height: 400px; object-fit: cover;"
      />
    <% } %>

    <!-- Listing Info Section -->
    <div class="listing-info mt-3 px-1 px-md-3">
      <p class="mb-1">
        Owned by:
        <b><i><%= listing.owner.username.toLowerCase() %></i></b>
      </p>
      <p class="text-secondary fs-5 mb-2"><%= listing.description %></p>
      <p class="fw-semibold fs-5 mb-2">‚Çπ<%= listing.price.toLocaleString("en-IN") %> / month</p>
      <span>+ 18% GST</span>
      <p class="text-muted">
        <i class="fa-solid fa-location-dot me-2"></i>
        <%= listing.location %>, <%= listing.country %>
      </p>
    </div>
  </div>

  <!-- Owner Controls -->
  <% if (currUser && listing.owner._id.equals(currUser._id)) { %>
  <div class="button-group">
    <a href="/listings" class="btn-outline">Back</a>
    <a href="/listings/<%= listing._id %>/edit" class="btn-solid">Edit</a>
    <button type="button" class="btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">Delete</button>
  </div>

  <!-- üåü Confirm Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content custom-modal shadow-lg border-0 animate__fadeInDown">
      <div class="modal-header border-0">
        <h5 class="modal-title text-danger fw-bold" id="confirmDeleteModalLabel">
          <i class="fa-solid fa-triangle-exclamation me-2 text-warning"></i>
          Confirm Delete
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center px-4">
        <p class="fs-6 text-dark mb-1">Are you sure you want to delete this listing?</p>
        <p class="text-muted"><strong>This action cannot be undone.</strong></p>
      </div>

      <div class="modal-footer border-0 justify-content-center pb-4">
        <button type="button" class="btn cancel-btn me-2" data-bs-dismiss="modal">
          Cancel
        </button>
        <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
          <button type="submit" class="btn delete-btn">
            <i class="fa-solid fa-trash-can me-1"></i> Delete
          </button>
        </form>
      </div>
    </div>
  </div>
</div>


  <% } %>

  <!-- Booking Section -->
  <div class="my-4 text-center">
    <a href="/bookings/<%= listing._id %>/new" class="btn btn-primary rounded-pill mt-3">
      <i class="fa-solid fa-calendar-check me-2"></i> Book Now
    </a>
  </div>
</div>



  <hr />
<div class="container my-5 review-form-wrapper">
  <h3 class="text-center mb-4 fw-semibold">Leave a Review</h3>

  <% if (currUser) { %>
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 col-sm-12">
        <form action="/listings/<%= listing._id %>/reviews" method="POST" class="needs-validation" novalidate>
          <div class="mb-3">
            <label for="rating" class="form-label">Rating:</label>
            <fieldset class="starability-slot">
              <!-- Star inputs -->
              <% for (let i = 1; i <= 5; i++) { %>
                <input type="radio" id="star<%= i %>" name="review[rating]" value="<%= i %>" <%= i === 2 ? 'checked' : '' %> />
                <label for="star<%= i %>" title="<%= i %> star"><%= i %> star</label>
              <% } %>
            </fieldset>
          </div>

          <div class="mb-4">
            <label for="comment" class="form-label">Comment:</label>
            <textarea name="review[comment]" id="comment" class="form-control" rows="4" required></textarea>
            <div class="invalid-feedback">Please enter a comment.</div>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-outline-dark rounded-pill">Submit Review</button>
          </div>
        </form>
      </div>
    </div>
  <% } %>
</div>


<hr>
<!-- REVIEWS SECTION -->
<div class="container my-5 review-form-wrapper">
  <h3 class="text-center mb-4 fw-semibold">Reviews</h3>
  <% if (listing.reviews.length > 0) {
  let avg = listing.reviews.reduce((sum, r) => sum + r.rating, 0) / listing.reviews.length;
%>
  <div class="container text-center my-5">
    <div class="p-3 rounded-4 shadow-sm border bg-white d-inline-block text-center review-summary">
      <i class="fa-solid fa-star fs-3 text-warning mb-2"></i>
      <h5 class="mb-0 fw-bold"><%= avg.toFixed(1) %> / 5</h5>
      <p class="text-muted small mb-0">Based on <%= listing.reviews.length %> reviews</p>
    </div>
  </div>
<% } %>

  <% if (listing.reviews.length === 0) { %>
    <div class="text-center text-muted py-4">
      <p class="mb-2 fs-5">No reviews yet. Be the first to leave one!</p>
    </div>
  <% } else { %>
    <div class="row g-3" id="reviewGrid">
      <% listing.reviews.forEach((review, index) => { %>
        <div class="col-12 col-sm-6 col-lg-4 review-item <%= index >= 6 ? 'd-none' : '' %>">
          <div class="card h-100 shadow-sm border-0 p-3 rounded-4">
            <div class="card-body d-flex flex-column justify-content-between p-0">
              <small class="text-muted mb-2 d-block"><%= review.createdAt.toDateString() %></small>
              <p class="fw-semibold mb-2 fs-6">
                <img src="https://plus.unsplash.com/premium_photo-1732757787588-29df717691f4?q=80&w=1054&auto=format&fit=crop"
                     alt="User"
                     class="rounded-circle me-2"
                     width="28"
                     height="28"
                />
                @<%= review.author.username %>
              </p>
              <p class="starability-result mb-2" data-rating="<%= review.rating %>"></p>
              <p class="text-dark fs-6 mb-3" style="min-height: 50px;">
                <i class="fa-solid fa-quote-left text-secondary me-2"></i>
                <%= review.comment %>
              </p>
              <% if (currUser && review.author._id.equals(currUser._id)) { %>
                <button class="btn btn-sm btn-outline-danger w-100 rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmReviewDeleteModal<%= review._id %>">
                  <i class="fa-solid fa-trash-can me-1"></i> Delete
                </button>

                <!-- Review Delete Modal -->
                <div class="modal fade" id="confirmReviewDeleteModal<%= review._id %>" tabindex="-1" aria-labelledby="confirmReviewDeleteModalLabel<%= review._id %>" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content custom-modal">
                      <div class="modal-header border-0">
                        <h5 class="modal-title text-danger fw-semibold" id="confirmReviewDeleteModalLabel<%= review._id %>">
                          <i class="fa-solid fa-circle-exclamation me-2"></i>Confirm Review Delete
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <p class="mb-2">Are you sure you want to delete this review?</p>
                        <p class="text-danger fw-semibold mb-0">This action cannot be undone.</p>
                      </div>
                      <div class="modal-footer border-0 d-flex justify-content-between">
                        <button type="button" class="btn btn-outline-secondary rounded-pill cancel-btn" data-bs-dismiss="modal">Cancel</button>
                        <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
                          <button type="submit" class="btn btn-danger rounded-pill delete-btn">
                            <i class="fa-solid fa-trash me-1"></i> Delete
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              <% } %>
            </div>
          </div>
        </div>
      <% }) %>
    </div>

    <% if (listing.reviews.length > 6) { %>
      <div class="text-center mt-4">
        <button class="btn btn-outline-dark rounded-pill px-4" id="loadMoreBtn">View More</button>
      </div>
    <% } %>
  <% } %>
</div>



<script>
  const input = document.getElementById("multiImageInput");
  const preview = document.getElementById("multiImagePreview");

  input?.addEventListener("change", function () {
    preview.innerHTML = "";
    Array.from(this.files).forEach((file) => {
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = document.createElement("img");
        img.src = e.target.result;
        img.className = "img-thumbnail m-2";
        img.style.width = "100px";
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>







<script>
  document.addEventListener("DOMContentLoaded", () => {
    const reviewItems = document.querySelectorAll(".review-item.d-none");
    const loadMoreBtn = document.getElementById("loadMoreBtn");
    let visibleCount = 6;

    loadMoreBtn?.addEventListener("click", () => {
      const hiddenItems = Array.from(reviewItems).filter(item => item.classList.contains("d-none"));
      const nextBatch = hiddenItems.slice(0, 3);
      nextBatch.forEach(item => item.classList.remove("d-none"));
      visibleCount += nextBatch.length;

      if (visibleCount >= document.querySelectorAll(".review-item").length) {
        loadMoreBtn.style.display = "none";
      }
    });
  });
</script>

<script>
  document.getElementById("loadMoreBtn")?.addEventListener("click", () => {
    const hiddenReviews = document.querySelectorAll(".review-item.d-none");
    for (let i = 0; i < 3 && i < hiddenReviews.length; i++) {
      hiddenReviews[i].classList.remove("d-none");
    }
    if (document.querySelectorAll(".review-item.d-none").length === 0) {
      document.getElementById("loadMoreBtn").style.display = "none";
    }
  });
</script>
